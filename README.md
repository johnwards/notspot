# Notspot

A clean-room HubSpot API mock server, built entirely by AI agents as a proof of concept.

## The Experiment

Could an AI agent, given only the public HubSpot API documentation and OpenAPI specs, build a functional mock server from scratch? One that implements the real API surface, stores data in SQLite, passes hundreds of tests, and even comes with a full web UI?

The answer is yes. Every line of Go, TypeScript, SQL, and configuration in this repository was generated by Claude Code (Anthropic's CLI coding agent). The human role was limited to directing what to build next and reviewing the output.

## What Was Built

### Mock Server (Go)

A standalone binary that mimics `api.hubapi.com`. Point your integration tests at it instead of the real HubSpot API.

- **CRM Objects** — Full CRUD, batch operations, archival, and merge for contacts, companies, deals, tickets, and engagements (calls, emails, meetings, notes, tasks)
- **Properties & Groups** — Schemaless EAV storage, property definitions with types/options/validation, property groups
- **Pipelines & Stages** — Deal and ticket pipelines with ordered stages
- **Associations v4** — Directional, labeled, many-to-many relationships between any object types, with batch operations
- **CRM Search** — Filter groups with operators (EQ, NEQ, LT, GT, BETWEEN, IN, etc.), cursor and offset pagination
- **Custom Object Schemas** — Create/delete custom object types at runtime
- **Imports & Exports** — Import/export task tracking with state machines
- **Owners** — Owner listing and assignment
- **Admin API** — `/_notspot/reset` to wipe and re-seed data between tests

All responses follow HubSpot's exact JSON format — error shapes, pagination cursors, correlation IDs, the lot.

### Web UI (React + TypeScript)

A full management interface served at `/_ui/` for inspecting and manipulating mock data.

- **Dashboard** — Recent records, deal pipeline summary, task overview
- **Object List Views** — Paginated tables with search, filtering, bulk actions, customizable columns
- **Record Detail** — Property editing, association management, activity timeline
- **Pipeline Board** — Kanban drag-and-drop for deals and tickets
- **Settings** — Property manager and pipeline configuration
- **Admin Panel** — Data reset and HTTP request log viewer
- **Command Palette** — Cmd+K global search across all object types

### Test Suite

- **500+ unit tests** with race detection
- **97 conformance tests** — black-box HTTP tests against a running server instance
- **Playwright e2e tests** for the web UI

## Quick Start

### Prerequisites

- Go 1.22+
- Node.js 18+ (for the web UI build)

### Build and Run

```bash
# Build everything (web UI + Go binary)
make build

# Run with an in-memory database (data resets on restart)
NOTSPOT_DB=:memory: ./build/hubspot

# Or persist data to a file
./build/hubspot
```

The server starts on `http://localhost:8080` by default. The web UI is at `http://localhost:8080/_ui/`.

### Configuration

| Variable | Default | Description |
|---|---|---|
| `NOTSPOT_ADDR` | `:8080` | Listen address |
| `NOTSPOT_DB` | `notspot.db` | SQLite path (`:memory:` for ephemeral) |
| `NOTSPOT_AUTH_TOKEN` | _(empty)_ | If set, requires `Bearer <token>` on all API requests |

### Seed with Sample Data

The server starts with the bare schema (object types, property definitions, pipelines, association types). To populate it with realistic data for demos or development, run the seed script:

```bash
npx tsx scripts/seed-data.ts
```

This generates ~950 deterministic B2B SaaS CRM records via the API itself:

- 100 companies with domains, industries, and lifecycle stages
- ~380 contacts distributed across companies (3-5 per company), with emails, phones, and lifecycle stages
- 60 deals spread across the Sales Pipeline stages with realistic amounts and close dates
- 40 tickets across Support Pipeline stages with priorities
- ~470 engagements (notes, calls, emails, tasks, meetings) with realistic content

All records are fully associated — contacts to their companies, deals and tickets to companies and contacts, engagements to the relevant records. The script points at `http://localhost:8080` by default, or pass a custom URL as the first argument.

Browse the result at `http://localhost:8080/_ui/`.

### Use in Tests

Point your HubSpot client at the mock server:

```go
// Example: override the base URL in your HubSpot SDK client
client := hubspot.NewClient(
    hubspot.WithBaseURL("http://localhost:8080"),
    hubspot.WithAccessToken("test-token"),
)
```

Reset state between tests:

```bash
curl -X POST http://localhost:8080/_notspot/reset
```

### Run the Test Suite

```bash
make check          # fmt + vet + lint + unit tests
make conformance    # black-box API conformance tests
make e2e            # Playwright browser tests
```

## Stack

- **Go** — stdlib `net/http` with Go 1.22+ routing patterns, no framework
- **SQLite** — via `modernc.org/sqlite` (pure Go, no CGO), WAL mode, foreign keys
- **React 19** + TypeScript + Vite + Tailwind CSS + shadcn/ui + TanStack Router/Query
- **Playwright** for e2e testing

## License

MIT
